#!/bin/bash

# ============================
# INSTALL.SH ‚Äì Sentinel Layer 
# ============================

YELLOW='\033[1;33m'
NC='\033[0m'

log() {
    echo -e "${YELLOW}==> [Sentinel] $1${NC}"
}

read -p "Souhaitez-vous (r√©)installer les outils et d√©pendances ? (y/n) " install_tools
if [[ "${install_tools,,}" != "y" ]]; then
    log "Installation annul√©e."
    exit 0
fi

log "Mise √† jour du syst√®me..."
if ! sudo apt update && sudo apt upgrade -y; then
    log "‚ùå √âchec de la mise √† jour du syst√®me."
    exit 1
fi

install_if_needed() {
    local pkg=$1
    if ! dpkg -l | grep -qw "$pkg"; then
        log "Installation de $pkg..."
        if ! sudo apt install -y "$pkg"; then
            log "‚ùå Erreur lors de l'installation de $pkg."
            exit 1
        fi
    else
        log "$pkg d√©j√† install√©, saut..."
    fi
}

log "Installation des outils n√©cessaires..."
tools=(
    nmap tcpdump tshark whois aircrack-ng sqlmap
    iperf3 iftop htop unzip arp-scan hydra john lynis bat
    neofetch zsh curl git
)
for tool in "${tools[@]}"; do
    install_if_needed "$tool"
done

log "Installation de Oh My Zsh..."
if [ ! -d "$HOME/.oh-my-zsh" ]; then
    RUNZSH=no CHSH=no sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
else
    log "Oh My Zsh est d√©j√† install√©, saut..."
fi

log "Configuration banni√®re Zsh..."
if ! grep -q "Sentinel ASCII Banner" ~/.zshrc; then
cat <<'EOF' >> ~/.zshrc

# Sentinel ASCII Banner
echo ""
echo "‚ñÄ‚ñà‚ñà‚ñà‚ñà‚ñÄ     ‚ñà     ‚ñÄ‚ñà‚ñà‚ñà‚ñÄ  ‚ñÑ‚ñà‚ñÑ‚ñÄ          ‚ñà‚ñà‚ñà‚ñÄ‚ñÄ‚ñà‚ñà‚ñÄ‚ñÄ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñÄ‚ñÄ‚ñÄ‚ñà‚ñà‚ñà "
echo "  ‚ñÄ‚ñà‚ñà     ‚ñÑ‚ñà‚ñà     ‚ñÑ‚ñà  ‚ñÑ‚ñà‚ñÄ             ‚ñà‚ñÄ   ‚ñà‚ñà   ‚ñÄ‚ñà ‚ñà‚ñà    ‚ñÄ‚ñà "
echo "   ‚ñà‚ñà‚ñÑ   ‚ñÑ‚ñà‚ñà‚ñà‚ñÑ   ‚ñÑ‚ñà  ‚ñÑ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñÑ      ‚ñÑ‚ñà‚ñà      ‚ñà‚ñà      ‚ñà‚ñà   ‚ñà   "
echo "    ‚ñà‚ñà‚ñÑ  ‚ñà‚ñÄ ‚ñà‚ñà‚ñÑ  ‚ñà‚ñÄ  ‚ñà‚ñà‚ñÄ  ‚ñÄ‚ñà‚ñà‚ñÑ   ‚ñà‚ñà‚ñà‚ñà      ‚ñà‚ñà      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   "
echo "    ‚ñÄ‚ñà‚ñà ‚ñà‚ñÄ  ‚ñÄ‚ñà‚ñà ‚ñà‚ñÄ   ‚ñà‚ñà     ‚ñà‚ñà ‚ñÑ‚ñà‚ñÄ ‚ñà‚ñà      ‚ñà‚ñà      ‚ñà‚ñà   ‚ñà  ‚ñÑ"
echo "     ‚ñÑ‚ñà‚ñà‚ñÑ    ‚ñÑ‚ñà‚ñà‚ñÑ    ‚ñà‚ñà‚ñÑ   ‚ñÑ‚ñà‚ñà‚ñà‚ñÄ   ‚ñà‚ñà      ‚ñà‚ñà      ‚ñà‚ñà     ‚ñÑ‚ñà"
echo "      ‚ñà‚ñà      ‚ñà‚ñà      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  ‚ñÑ‚ñà‚ñà‚ñà‚ñà‚ñÑ  ‚ñÑ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà"
echo "                                   ‚ñà‚ñà                       "
echo "                                   ‚ñà‚ñà                       "
echo ""
echo "                    Welcome to Sentinel OS                 "
echo "------------------------------------------------------------"
echo ""

# Alias Outils
alias sniff='sudo tcpdump -i any'
alias live='sudo iftop'
alias scan='nmap -sV -T4'

# Alias Sentinel
alias sentinel-help='cat ~/sentinel/docs/tools_doc.txt'
alias sentinel-system='neofetch --cpu_temp --gpu_temp'

EOF
fi

log "Changement de shell vers Zsh..."
chsh -s "$(which zsh)"

mkdir -p ~/sentinel/docs

log "Cr√©ation de la documentation..."
cat <<'EOF' > ~/sentinel/docs/tools_doc.txt
# Liste des Outils disponibles dans Sentinel

nmap : Scan r√©seau
tcpdump : Capture r√©seau
tshark : Wireshark CLI
whois : Infos domaine
aircrack-ng : S√©curit√© Wi-Fi
sqlmap : Injection SQL
iperf3 : Bande passante
iftop : Trafic r√©seau live
htop : Ressources syst√®me
unzip : D√©compression ZIP
arp-scan : D√©couverte r√©seau local
hydra : Brute-force
john : Cracking de hash
lynis : Audit s√©curit√©
bat : cat am√©lior√©
neofetch : Affiche infos syst√®me
EOF

chmod +x ~/sentinel/docs/tools_doc.txt

log "‚úÖ Installation termin√©e."
echo "üëâ Lance une nouvelle session ou tape 'source ~/.zshrc' pour activer les alias."
echo "üëâ Utilise 'sentinel-help' pour lire la documentation rapide."
